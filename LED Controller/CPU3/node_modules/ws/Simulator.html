<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Client</title>
    <style>
        body {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        iframe {
            width: 400;
            height: 800px;
            border: 1px solid #ccc;
            margin-right: 20px;
        }
        .input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .input-row {
            display: flex; /* Use flexbox for the input and button */
            align-items: center; /* Center vertically */
        }
        label {
            font-size: 16px;
        }
        input {
            padding: 8px;
            font-size: 16px;
            width: 100px; /* Adjusted width for a more narrow input box */
            margin-right: 10px; /* Space between input and button */
        }
        button {
            padding: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <iframe src="../../data/index.html" title="Content Frame" width="400" height="600"></iframe>
    
    <div class="input-container">
        <div class="input-row">
            <input type="text" id="Amp_Gain" placeholder="Amp Gain" />
            <button onclick="sendSignal('Amp_Gain')">Amp Gain</button>
        </div>
        <div class="input-row">
            <input type="text" id="FFT_Gain" placeholder="FFT Gain" />
            <button onclick="sendSignal('FFT_Gain')">FFT Gain</button>
        </div>
        <div class="input-row">
            <input type="text" id="Input_Source" placeholder="Input Source" />
            <button onclick="sendSignal('Input_Source')">Input Source</button>
        </div>
        <div class="input-row">
            <input type="text" id="Output_Source" placeholder="Output Source" />
            <button onclick="sendSignal('Output_Source')">Output Source</button>
        </div>
        <div class="input-row">
            <input type="text" id="Sink_Connect" placeholder="Sink Connect" />
            <button onclick="sendSignal('Sink_Connect')">Sink Connect</button>
        </div>
    </div>

    <script>
        const socket = new WebSocket('ws://localhost:81');

        function announceHere() {
            socket.send('Simulator Web Socket is here!');
        }

        socket.onopen = () => {
            console.log('Simulator: Connected to WebSocket server');
            this.announceHere();
        };

        socket.onmessage = (event) => {
            let message;
            if(typeof event.data === 'string')
            {
                try {
                    message = JSON.parse(event.data);
                    console.log('Simulator: Message from server:', message);
                } catch (error) {
                    console.error('Simulator: Invalid JSON received:', event.data);
                    return;
                }

                Object.keys(message).forEach((key) => {
                    if (key === 'SignalValue') {
                        const { Id, Value } = message[key];
                        const inputField = document.getElementById(Id);
                        console.log('Id:', Id);
                        if (inputField) {
                            inputField.value = Value;
                        }
                    }
                });
            }
        };

        socket.onclose = () => {
            console.log('Simulator: Disconnected from WebSocket server');
        };

        function sendSignal(signalId) {
            const value = document.getElementById(signalId).value;

            const message = {
                SignalValue: {
                    Id: signalId,
                    Value: value
                }
            };

            if (socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify(message));
                console.log(`Simulator: Sent: ${JSON.stringify(message)}`);
            } else {
                console.log('Simulator: WebSocket is not open. Unable to send message.');
            }
        }
    </script>

</body>
</html>
